name: CI

on:
  # Disable auto triggers; allow only manual trigger
  workflow_dispatch:
    inputs:
      commit_sha:
        description: "Enter the commit SHA to fetch file contents"
        required: true
      environment:
        description: "Select environment"
        required: true
        type: choice
        options:
          - dev
          - test
          - prod
        default: dev

jobs:
  build1:
    name: üèóÔ∏è Build 1 - Fetch Files
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository at specific commit
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.commit_sha }}

      - name: Show environment and commit info
        run: |
          echo "Environment: ${{ github.event.inputs.environment }}"
          echo "Commit SHA: ${{ github.event.inputs.commit_sha }}"

      - name: Display contents of files
        run: |
          echo "===== f1.txt ====="
          cat f1.txt
          echo "===== f2.txt ====="
          cat f2.txt
          echo "===== f3.txt ====="
          cat f3.txt

  build2:
    name: üöÄ Build 2 - Post Process
    runs-on: ubuntu-latest
    needs: build1

    steps:
      - name: Checkout repository at specific commit
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.commit_sha }}

      - name: Print summary
        run: |
          echo "‚úÖ Successfully read files from commit ${{ github.event.inputs.commit_sha }}"
          echo "Environment: ${{ github.event.inputs.environment }}"
