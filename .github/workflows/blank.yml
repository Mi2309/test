name: CI

on:
  # Disable auto triggers; allow only manual trigger
  workflow_dispatch:
    inputs:
      commit_sha:
        description: "Enter the commit SHA to fetch file contents"
        required: true
      environment:
        description: "Select environment"
        required: true
        type: choice
        options:
          - dev
          - test
          - prod
        default: dev

jobs:
  build1:
    name: üèóÔ∏è Build 1 - Fetch Files from Commit
    runs-on: ubuntu-latest

    steps:
      - name: Checkout main branch at specific commit
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Switch to specific commit
        run: |
          git fetch origin ${{ github.event.inputs.commit_sha }}
          git checkout ${{ github.event.inputs.commit_sha }}

      - name: Display commit info
        run: echo "Reading files from commit: ${{ github.event.inputs.commit_sha }}"

      - name: Show file contents
        run: |
          echo "===== f1.txt ====="
          cat f1.txt || echo "‚ö†Ô∏è f1.txt not found"
          echo "===== f2.txt ====="
          cat f2.txt || echo "‚ö†Ô∏è f2.txt not found"
          echo "===== f3.txt ====="
          cat f3.txt || echo "‚ö†Ô∏è f3.txt not found"

  build2:
    name: üöÄ Build 2 - Summary
    runs-on: ubuntu-latest
    needs: build1

    steps:
      - name: Checkout main branch at same commit
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.commit_sha }}

      - name: Summary
        run: echo "‚úÖ Files read successfully from commit ${{ github.event.inputs.commit_sha }}"
